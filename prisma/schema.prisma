generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model Session {
  id                  String   @id @default(cuid())
  code                String   @unique // e.g., "1YY1LV"
  facilitatorEmail    String
  unlockedComponents  String   @default("") // Comma-separated component IDs
  unlockedBonusCards  String   @default("") // Comma-separated bonus component IDs
  bonusEnabled        Boolean  @default(false) // Whether bonus cards are enabled for this session
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  participants        Participant[]
  
  // Index for faster facilitator queries
  @@index([facilitatorEmail])
}

model Participant {
  id                    String   @id @default(cuid())
  email                 String   @unique
  passcode              String   // Legacy field, can be session code
  name                  String?
  
  // Session relationship
  sessionId             String?
  session               Session? @relation(fields: [sessionId], references: [id])
  
  // Card randomization - stores the order of component IDs for this player's card
  cardLayout            String   @default("") // Comma-separated component IDs in random order
  
  // Progress tracking
  completedComponents   String   @default("") // Comma-separated IDs of tiles marked complete
  completedBonusCards   String   @default("") // Comma-separated IDs of bonus cards completed
  bingoLines            Int      @default(0)  // Number of bingo lines completed
  bonusPoints           Int      @default(0)  // Points earned from bonus cards
  achievements          String   @default("") // Comma-separated achievement IDs
  
  // Legacy field (keeping for backward compatibility)
  unlockedComponentIds  String   @default("")
  isCompleted           Boolean  @default(false)
  
  joinedAt              DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  // Indexes for faster queries
  @@index([sessionId])
  @@index([email])
}
